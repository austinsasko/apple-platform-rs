# We can force the use of specific digests.

```
$ rcodesign debug-create-macho exe
assuming default minimum version 11.0.0
writing Mach-O to exe

$ rcodesign sign --digest sha1 exe exe.signed
signing exe to exe.signed
signing exe as a Mach-O binary
inferring default signing settings from Mach-O binary
setting binary identifier to exe
parsing Mach-O
signing Mach-O binary at index 0
binary targets macOS >= 11.0.0 with SDK 11.0.0
creating ad-hoc signature
code directory version: 132096
total signature size: 288 bytes
writing Mach-O to exe.signed

$ rcodesign print-signature-info exe.signed
- path: exe.signed
  file_size: 22530
  file_sha256: c8e9dd0b1ef927e35ecf14dd02ad45ad6c1079fb46127109ddf05a50090e9570
  entity:
    mach_o:
      linkedit_segment_file_start_offset: 16384
      linkedit_segment_file_end_offset: 22530
      signature_file_start_offset: 16386
      signature_file_end_offset: 22530
      signature_linkedit_start_offset: 2
      signature_linkedit_end_offset: 6146
      signature:
        superblob_length: 288
        blob_count: 3
        blobs:
        - slot: CodeDirectory (0)
          magic: fade0c02
          length: 232
          sha1: cffe46f2192da3e53a6008ae475add423af6ed69
          sha256: 522060048378c495b43dadb498ee77fdb71ee97751247021df9f85cafc9cbe44
        - slot: RequirementSet (2)
          magic: fade0c01
          length: 12
          sha1: 3a75f6db058529148e14dd7ea1b4729cc09ec973
          sha256: 987920904eab650e75788c054aa0b0524e6a80bfc71aa32df8d237a61743f986
        - slot: CMS Signature (65536)
          magic: fade0b01
          length: 8
          sha1: 2a7254313aa41796079bb0e9d0f044345f69f98b
          sha256: e6c83bc98a10348492c7d4d2378a54572ef29e1a5692ccd02b5e29f4b762d6a0
        code_directory:
          version: '0x20400'
          flags: CodeSignatureFlags(ADHOC)
          identifier: exe
          digest_type: sha1
          platform: 0
          signed_entity_size: 16386
          executable_segment_flags: ExecutableSegmentFlags(MAIN_BINARY)
          code_digests_count: 5
          slot_digests:
          - 'Info (1): 0000000000000000000000000000000000000000'
          - 'RequirementSet (2): 3a75f6db058529148e14dd7ea1b4729cc09ec973'
        entitlements_plist: null
        cms: null

```

```
$ rcodesign debug-create-macho exe
assuming default minimum version 11.0.0
writing Mach-O to exe

$ rcodesign sign --digest sha1 --extra-digest sha256 exe exe.signed
signing exe to exe.signed
signing exe as a Mach-O binary
inferring default signing settings from Mach-O binary
setting binary identifier to exe
parsing Mach-O
signing Mach-O binary at index 0
binary targets macOS >= 11.0.0 with SDK 11.0.0
creating ad-hoc signature
code directory version: 132096
adding alternative code directory using digest Sha256
binary targets macOS >= 11.0.0 with SDK 11.0.0
creating ad-hoc signature
total signature size: 612 bytes
writing Mach-O to exe.signed

$ rcodesign print-signature-info exe.signed
- path: exe.signed
  file_size: 23554
  file_sha256: 0739c3de4e409ee32394619a88f654510c25f44b5448a1cffcb5e7c74a1c0c51
  entity:
    mach_o:
      linkedit_segment_file_start_offset: 16384
      linkedit_segment_file_end_offset: 23554
      signature_file_start_offset: 16386
      signature_file_end_offset: 23554
      signature_linkedit_start_offset: 2
      signature_linkedit_end_offset: 7170
      signature:
        superblob_length: 612
        blob_count: 4
        blobs:
        - slot: CodeDirectory (0)
          magic: fade0c02
          length: 232
          sha1: 07667ed73d516f37f76b746e24297952d16c7c57
          sha256: 841655055d25087f238c2bd1dba607303e5f3be60a53240444af14c2ea650679
        - slot: RequirementSet (2)
          magic: fade0c01
          length: 12
          sha1: 3a75f6db058529148e14dd7ea1b4729cc09ec973
          sha256: 987920904eab650e75788c054aa0b0524e6a80bfc71aa32df8d237a61743f986
        - slot: 'CodeDirectory Alternate #0 (4096)'
          magic: fade0c02
          length: 316
          sha1: 987b58126b8d4f4c860998dbcbe7374d31585ace
          sha256: 1ac9896a06f399a390cd0eddb26d19762efa952ca1e87a6467eba81e6f041aef
        - slot: CMS Signature (65536)
          magic: fade0b01
          length: 8
          sha1: 2a7254313aa41796079bb0e9d0f044345f69f98b
          sha256: e6c83bc98a10348492c7d4d2378a54572ef29e1a5692ccd02b5e29f4b762d6a0
        code_directory:
          version: '0x20400'
          flags: CodeSignatureFlags(ADHOC)
          identifier: exe
          digest_type: sha1
          platform: 0
          signed_entity_size: 16386
          executable_segment_flags: ExecutableSegmentFlags(MAIN_BINARY)
          code_digests_count: 5
          slot_digests:
          - 'Info (1): 0000000000000000000000000000000000000000'
          - 'RequirementSet (2): 3a75f6db058529148e14dd7ea1b4729cc09ec973'
        alternative_code_directories:
        - - 'CodeDirectory Alternate #0 (4096)'
          - version: '0x20400'
            flags: CodeSignatureFlags(ADHOC)
            identifier: exe
            digest_type: sha256
            platform: 0
            signed_entity_size: 16386
            executable_segment_flags: ExecutableSegmentFlags(MAIN_BINARY)
            code_digests_count: 5
            slot_digests:
            - 'Info (1): 0000000000000000000000000000000000000000000000000000000000000000'
            - 'RequirementSet (2): 987920904eab650e75788c054aa0b0524e6a80bfc71aa32df8d237a61743f986'
        entitlements_plist: null
        cms: null

```

# Signing a binary supporting old macOS automatically adds SHA-1 digests.

```
$ rcodesign debug-create-macho --minimum-os-version 10.11.3 exe
writing Mach-O to exe

$ rcodesign sign exe exe.signed
signing exe to exe.signed
signing exe as a Mach-O binary
inferring default signing settings from Mach-O binary
activating SHA-1 digests because minimum OS target 10.11.3 is not >=10.11.4
setting binary identifier to exe
parsing Mach-O
signing Mach-O binary at index 0
binary targets macOS >= 10.11.3 with SDK 10.11.3
creating ad-hoc signature
code directory version: 132096
adding alternative code directory using digest Sha256
binary targets macOS >= 10.11.3 with SDK 10.11.3
creating ad-hoc signature
total signature size: 612 bytes
writing Mach-O to exe.signed

$ rcodesign print-signature-info exe.signed
- path: exe.signed
  file_size: 23554
  file_sha256: 2cd0a6b20ab9737aecfeeca97fb233da1e9e9a42d4ed0ca8affa4327ca3fe611
  entity:
    mach_o:
      linkedit_segment_file_start_offset: 16384
      linkedit_segment_file_end_offset: 23554
      signature_file_start_offset: 16386
      signature_file_end_offset: 23554
      signature_linkedit_start_offset: 2
      signature_linkedit_end_offset: 7170
      signature:
        superblob_length: 612
        blob_count: 4
        blobs:
        - slot: CodeDirectory (0)
          magic: fade0c02
          length: 232
          sha1: 8845581bfcacfffe1167c3442e5b8ad0e7b2f190
          sha256: da5b0476ae68210dfff52b71956a7e9afee0997ba92bb5c07f599daeed839301
        - slot: RequirementSet (2)
          magic: fade0c01
          length: 12
          sha1: 3a75f6db058529148e14dd7ea1b4729cc09ec973
          sha256: 987920904eab650e75788c054aa0b0524e6a80bfc71aa32df8d237a61743f986
        - slot: 'CodeDirectory Alternate #0 (4096)'
          magic: fade0c02
          length: 316
          sha1: 222311dd217bae69ce4c4ec9a566a384df5d766e
          sha256: a4ab76ba3703d5a0039bee7db5726d9064bdb07da60ab85d871ea2263325dc92
        - slot: CMS Signature (65536)
          magic: fade0b01
          length: 8
          sha1: 2a7254313aa41796079bb0e9d0f044345f69f98b
          sha256: e6c83bc98a10348492c7d4d2378a54572ef29e1a5692ccd02b5e29f4b762d6a0
        code_directory:
          version: '0x20400'
          flags: CodeSignatureFlags(ADHOC)
          identifier: exe
          digest_type: sha1
          platform: 0
          signed_entity_size: 16386
          executable_segment_flags: ExecutableSegmentFlags(MAIN_BINARY)
          code_digests_count: 5
          slot_digests:
          - 'Info (1): 0000000000000000000000000000000000000000'
          - 'RequirementSet (2): 3a75f6db058529148e14dd7ea1b4729cc09ec973'
        alternative_code_directories:
        - - 'CodeDirectory Alternate #0 (4096)'
          - version: '0x20400'
            flags: CodeSignatureFlags(ADHOC)
            identifier: exe
            digest_type: sha256
            platform: 0
            signed_entity_size: 16386
            executable_segment_flags: ExecutableSegmentFlags(MAIN_BINARY)
            code_digests_count: 5
            slot_digests:
            - 'Info (1): 0000000000000000000000000000000000000000000000000000000000000000'
            - 'RequirementSet (2): 987920904eab650e75788c054aa0b0524e6a80bfc71aa32df8d237a61743f986'
        entitlements_plist: null
        cms: null

```

Signing a binary without Mach-O targeting adds SHA-1 digests

```
$ rcodesign debug-create-macho --no-targeting exe
writing Mach-O to exe

$ rcodesign sign exe exe.signed
signing exe to exe.signed
signing exe as a Mach-O binary
inferring default signing settings from Mach-O binary
activating SHA-1 digests because no platform targeting in Mach-O
setting binary identifier to exe
parsing Mach-O
signing Mach-O binary at index 0
creating ad-hoc signature
code directory version: 132096
adding alternative code directory using digest Sha256
creating ad-hoc signature
total signature size: 612 bytes
writing Mach-O to exe.signed

$ rcodesign print-signature-info exe.signed
- path: exe.signed
  file_size: 23554
  file_sha256: 1d2d4cd3e79b9d5a50741521062cb7232094ea8a754de1f4fa26fa5fe85974c5
  entity:
    mach_o:
      linkedit_segment_file_start_offset: 16384
      linkedit_segment_file_end_offset: 23554
      signature_file_start_offset: 16386
      signature_file_end_offset: 23554
      signature_linkedit_start_offset: 2
      signature_linkedit_end_offset: 7170
      signature:
        superblob_length: 612
        blob_count: 4
        blobs:
        - slot: CodeDirectory (0)
          magic: fade0c02
          length: 232
          sha1: 5b1a8a0f511dee4c5a598e07cafe11c8da2f3d20
          sha256: dfeb49a8f1e1fd3a5cb3f8c718b1586e4c730e82b465fc99c00711d255f82377
        - slot: RequirementSet (2)
          magic: fade0c01
          length: 12
          sha1: 3a75f6db058529148e14dd7ea1b4729cc09ec973
          sha256: 987920904eab650e75788c054aa0b0524e6a80bfc71aa32df8d237a61743f986
        - slot: 'CodeDirectory Alternate #0 (4096)'
          magic: fade0c02
          length: 316
          sha1: 10bd9dd6ccdc9c40b9f6c06f98aeeac075de7412
          sha256: e22052a8ab21ac2250d11d0227eef77692251339d5d15b293fc01600624f86bc
        - slot: CMS Signature (65536)
          magic: fade0b01
          length: 8
          sha1: 2a7254313aa41796079bb0e9d0f044345f69f98b
          sha256: e6c83bc98a10348492c7d4d2378a54572ef29e1a5692ccd02b5e29f4b762d6a0
        code_directory:
          version: '0x20400'
          flags: CodeSignatureFlags(ADHOC)
          identifier: exe
          digest_type: sha1
          platform: 0
          signed_entity_size: 16386
          executable_segment_flags: ExecutableSegmentFlags(MAIN_BINARY)
          code_digests_count: 5
          slot_digests:
          - 'Info (1): 0000000000000000000000000000000000000000'
          - 'RequirementSet (2): 3a75f6db058529148e14dd7ea1b4729cc09ec973'
        alternative_code_directories:
        - - 'CodeDirectory Alternate #0 (4096)'
          - version: '0x20400'
            flags: CodeSignatureFlags(ADHOC)
            identifier: exe
            digest_type: sha256
            platform: 0
            signed_entity_size: 16386
            executable_segment_flags: ExecutableSegmentFlags(MAIN_BINARY)
            code_digests_count: 5
            slot_digests:
            - 'Info (1): 0000000000000000000000000000000000000000000000000000000000000000'
            - 'RequirementSet (2): 987920904eab650e75788c054aa0b0524e6a80bfc71aa32df8d237a61743f986'
        entitlements_plist: null
        cms: null

```
